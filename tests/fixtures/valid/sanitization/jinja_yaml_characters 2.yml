# Special Character Sanitization Test
# Tests that Jinja and YAML-breaking characters are properly sanitized

version: 2

models:
  - name: special_chars_test
    description: Table with special characters in sample values
    meta:
      sst:
        database: ANALYTICS
        schema: test
        table: SPECIAL_CHARS
        primary_key:
          - id
    columns:
      # Sample values with Jinja template characters (should be sanitized)
      - name: jinja_braces
        description: Values with Jinja double braces
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "{{@aiql query data}}"
              - "{%- set var = value -%}"
              - "{# this is a comment #}"
              - "{{{triple braces}}}"
            is_enum: false
      
      # Sample values with YAML-breaking start characters (should be sanitized)
      - name: yaml_breaking_start
        description: Values starting with YAML special chars
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - ">redirect output"
              - "|pipe character"
              - "&anchor reference"
              - "*alias reference"
              - "@mention user"
              - "`backtick code`"
            is_enum: false
      
      # Sample values with single quotes (should be escaped for SQL)
      - name: single_quotes
        description: Values with single quotes
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "O'Reilly"
              - "McDonald's"
              - "It's working"
              - "' OR 1=1 --"
            is_enum: false
      
      # Sample values with double quotes
      - name: double_quotes
        description: Values with double quotes
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - 'He said "Hello"'
              - 'The "best" product'
            is_enum: false
      
      # Sample values with backslashes
      - name: backslashes
        description: Values with backslashes
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "C:\\Users\\Documents"
              - "\\network\\share"
              - "Escape\\nSequence"
            is_enum: false
      
      # Sample values with newlines and tabs
      - name: whitespace_chars
        description: Values with newlines and tabs
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "Line 1\\nLine 2"
              - "Tab\\there"
              - "Multiple\\n\\nNewlines"
            is_enum: false
      
      # Sample values with Unicode
      - name: unicode_chars
        description: Values with Unicode characters
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "CafÃ©"
              - "naÃ¯ve"
              - "åŒ—äº¬"
              - "ðŸŽ‰"
              - "Ã‘oÃ±o"
            is_enum: false
      
      # Very long sample values (should be truncated)
      - name: long_values
        description: Values exceeding 1000 characters
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "a"  # Will be 1500 'a's in actual test
            is_enum: false
      
      # Sample values that are valid SQL but look suspicious
      - name: sql_like_values
        description: Values that look like SQL
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            sample_values:
              - "SELECT * FROM users"
              - "DROP TABLE important"
              - "1=1"
              - "OR true"
            is_enum: false


snowflake_metrics:
  - name: total_revenue
    description: "Total revenue from all completed orders"
    expr: "SUM({{ column('orders', 'amount') }})"
    tables:
      - "{{ table('orders') }}"
  
  - name: active_users
    description: "Count of users who have been active in the last 30 days"
    expr: "COUNT(DISTINCT {{ column('users', 'id') }})"
    tables:
      - "{{ table('users') }}"
  
  - name: average_order_value
    description: "Average value of completed orders"
    expr: "{{ metric('total_revenue') }} / NULLIF(COUNT({{ column('orders', 'id') }}), 0)"
    tables:
      - "{{ table('orders') }}"

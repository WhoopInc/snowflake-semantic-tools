# Field Type Validation
# Category 4: Tests that field types are correct (list vs string, etc.)

snowflake_metrics:
  # Tables as string instead of list
  - name: tables_as_string
    expr: "SUM(x)"
    tables: "{{ table('transactions') }}"  # Should be a list
    description: Tables field is string instead of list
  
  # Tables as number
  - name: tables_as_number
    expr: "SUM(x)"
    tables: 123
    description: Tables field is number instead of list
  
  # Tables as dict
  - name: tables_as_dict
    expr: "SUM(x)"
    tables:
      table1: "transactions"
    description: Tables field is dict instead of list
  
  # Expr as number
  - name: expr_as_number
    expr: 12345
    tables:
      - "{{ table('test') }}"
    description: Expression is number instead of string
  
  # Expr as list
  - name: expr_as_list
    expr:
      - "SUM(x)"
      - "COUNT(y)"
    tables:
      - "{{ table('test') }}"
    description: Expression is list instead of string
  
  # Synonyms as string instead of list
  - name: synonyms_as_string
    expr: "SUM(x)"
    tables:
      - "{{ table('test') }}"
    synonyms: "revenue, sales"  # Should be a list
    description: Synonyms field is string instead of list

snowflake_filters:
  # Expr as list
  - name: filter_expr_as_list
    expr:
      - "status = 'active'"
      - "deleted_at IS NULL"
    description: Filter expression is list instead of string
  
  # Tables as list (filters don't have tables field)
  - name: filter_with_tables
    expr: "status = 'active'"
    tables:
      - "{{ table('test') }}"
    description: Filter incorrectly has tables field

snowflake_relationships:
  # Relationship_columns as string
  - name: rel_columns_as_string
    left_table: "{{ table('orders') }}"
    right_table: "{{ table('users') }}"
    join_type: left_outer
    relationship_type: many_to_one
    relationship_columns: "user_id"  # Should be a list of mappings
  
  # Relationship_columns with invalid structure
  - name: rel_columns_invalid_structure
    left_table: "{{ table('orders') }}"
    right_table: "{{ table('users') }}"
    join_type: left_outer
    relationship_type: many_to_one
    relationship_columns:
      - "user_id"  # Should be dict with left_column/right_column
  
  # Join_type as list
  - name: join_type_as_list
    left_table: "{{ table('orders') }}"
    right_table: "{{ table('users') }}"
    join_type:
      - left_outer
    relationship_type: many_to_one
    relationship_columns:
      - left_column: "{{ column('orders', 'user_id') }}"
        right_column: "{{ column('users', 'id') }}"

snowflake_verified_queries:
  # SQL as list
  - name: sql_as_list
    sql:
      - "SELECT * FROM test"
      - "WHERE status = 'active'"
    tables:
      - "{{ table('test') }}"
    description: SQL is list instead of string
  
  # Tables as string
  - name: tables_as_string
    sql: "SELECT * FROM test"
    tables: "{{ table('test') }}"  # Should be a list
    description: Tables field is string instead of list

semantic_views:
  # Tables as string
  - name: view_tables_as_string
    tables: "{{ table('test') }}"  # Should be a list
    description: Semantic view with tables as string
  
  # Tables as dict
  - name: view_tables_as_dict
    tables:
      test: "{{ table('test') }}"
    description: Semantic view with tables as dict


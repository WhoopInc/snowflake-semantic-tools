# Template Resolution Edge Cases
# Tests malformed, invalid, and edge case template syntax

snowflake_metrics:
  # Missing closing brace
  - name: unclosed_template
    expr: "SUM({{ column('transactions', 'amount')"
    tables:
      - "{{ table('transactions') }}"
    description: Template missing closing braces
  
  # Extra closing brace
  - name: extra_closing
    expr: "SUM({{ column('transactions', 'amount') }})"
    tables:
      - "{{ table('transactions') }}"
    description: Template with extra closing brace
  
  # Wrong function name
  - name: invalid_function
    expr: "SUM({{ invalid_func('transactions', 'amount') }})"
    tables:
      - "{{ table('transactions') }}"
    description: Template with invalid function name
  
  # table() with no arguments
  - name: table_no_args
    expr: "SUM(amount)"
    tables:
      - "{{ table() }}"
    description: table() template with no arguments
  
  # table() with too many arguments
  - name: table_too_many_args
    expr: "SUM(amount)"
    tables:
      - "{{ table('transactions', 'extra_arg') }}"
    description: table() template with too many arguments
  
  # column() with only one argument
  - name: column_one_arg
    expr: "SUM({{ column('amount') }})"
    tables:
      - "{{ table('transactions') }}"
    description: column() template missing table parameter
  
  # column() with three arguments
  - name: column_three_args
    expr: "SUM({{ column('transactions', 'amount', 'extra') }})"
    tables:
      - "{{ table('transactions') }}"
    description: column() template with too many arguments
  
  # Empty string argument
  - name: empty_table_name
    expr: "SUM(amount)"
    tables:
      - "{{ table('') }}"
    description: table() template with empty string
  
  # Whitespace variations (these should work)
  - name: whitespace_variations
    expr: "SUM({{column('transactions','amount')}})"  # No spaces
    tables:
      - "{{table('transactions')}}"  # No spaces
    description: Template with no whitespace (should still work)
  
  # Mixed quote types
  - name: mixed_quotes
    expr: 'SUM({{ column("transactions", "amount") }})'
    tables:
      - '{{ table("transactions") }}'
    description: Template with double quotes instead of single
  
  # Nested templates (invalid)
  - name: nested_templates
    expr: "SUM({{ column('{{ table_var }}', 'amount') }})"
    tables:
      - "{{ table('transactions') }}"
    description: Nested template (not supported)
  
  # Number instead of string
  - name: number_argument
    expr: "SUM(amount)"
    tables:
      - "{{ table(123) }}"
    description: table() with number instead of string
  
  # Special characters in table name
  - name: special_chars_in_name
    expr: "SUM(amount)"
    tables:
      - "{{ table('trans-actions') }}"
    description: table() with special characters in name
  
  # Case variations in function name
  - name: case_variations
    expr: "SUM(amount)"
    tables:
      - "{{ TABLE('transactions') }}"  # Uppercase function
    description: Template function with different case
  
  # metric() referencing non-existent metric
  - name: nonexistent_metric_ref
    expr: "{{ metric('does_not_exist') }} * 2"
    tables:
      - "{{ table('transactions') }}"
    description: metric() template referencing non-existent metric
  
  # Circular metric reference
  - name: circular_metric_a
    expr: "{{ metric('circular_metric_b') }} + 100"
    tables:
      - "{{ table('transactions') }}"
    description: Part of circular metric dependency
  
  - name: circular_metric_b
    expr: "{{ metric('circular_metric_a') }} * 2"
    tables:
      - "{{ table('transactions') }}"
    description: Part of circular metric dependency (completes circle)


# dbt Model Metadata - Missing Critical Fields
# Tests that missing primary_key is properly detected as an ERROR
# Note: database and schema are auto-detected from manifest.json (not required in YAML)

version: 2

models:
  # Missing primary_key (ERROR - this is the ONLY required field in meta.sst at table level)
  - name: missing_primary_key
    description: Model missing primary_key (this is an ERROR)
    meta:
      sst:
        # NOTE: database and schema NOT required - auto-detected from manifest.json
        # Only primary_key is required in meta.sst at table level
        table: USERS
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Explicit test: database should be IGNORED even if present (manifest takes precedence)
  - name: database_ignored_uses_manifest
    description: Model with database specified, but manifest.json value should be used instead
    meta:
      sst:
        database: WRONG_DATABASE  # This should be ignored
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Explicit test: schema should be IGNORED even if present (manifest takes precedence)
  - name: schema_ignored_uses_manifest
    description: Model with schema specified, but manifest.json value should be used instead
    meta:
      sst:
        schema: WRONG_SCHEMA  # This should be ignored
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Empty primary_key list
  - name: empty_primary_key
    description: Model with empty primary_key list
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key: []
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Primary key as string instead of list
  - name: primary_key_wrong_type
    description: Primary key as string instead of list
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key: "user_id"  # Should be: ["user_id"]
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Primary key references non-existent column
  - name: primary_key_nonexistent_column
    description: Primary key references column not in table
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key:
          - nonexistent_column
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: NUMBER
            is_enum: false
  
  # Missing meta entirely
  - name: no_meta
    description: Model with no meta section at all
    columns:
      - name: user_id
        description: User ID
  
  # Has meta but no sst
  - name: no_sst
    description: Model with meta but no sst section
    meta:
      materialized: table
    columns:
      - name: user_id
        description: User ID
  
  # Column missing column_type
  - name: column_missing_type
    description: Model with column missing column_type
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            data_type: NUMBER
            is_enum: false
            # Missing column_type
  
  # Column with invalid column_type
  - name: column_invalid_type
    description: Model with invalid column_type
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            column_type: measure  # Invalid - should be: dimension, fact, or time_dimension
            data_type: NUMBER
            is_enum: false
  
  # Column missing data_type
  - name: column_missing_data_type
    description: Model with column missing data_type
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            is_enum: false
            # Missing data_type
  
  # Column with invalid data_type (unsupported Snowflake type)
  - name: column_invalid_data_type
    description: Model with invalid data_type
    meta:
      sst:
        # database and schema not required - auto-detected from manifest
        primary_key:
          - user_id
    columns:
      - name: user_id
        meta:
          sst:
            column_type: dimension
            data_type: VARCHAR2  # Invalid - not a Snowflake type
            is_enum: false


# Test fixtures for missing table references in relationships
# These should all trigger errors because the referenced tables don't exist in the dbt catalog

snowflake_relationships:
  # Test 1: Missing left table
  - name: relationship_missing_left_table
    description: "Should error: left table doesn't exist in dbt catalog"
    left_table: "{{ table('nonexistent_orders') }}"
    right_table: "{{ table('users') }}"
    relationship_conditions:
      - "{{ column('nonexistent_orders', 'user_id') }} = {{ column('users', 'id') }}"
  
  # Test 2: Missing right table
  - name: relationship_missing_right_table
    description: "Should error: right table doesn't exist in dbt catalog"
    left_table: "{{ table('orders') }}"
    right_table: "{{ table('nonexistent_users') }}"
    relationship_conditions:
      - "{{ column('orders', 'user_id') }} = {{ column('nonexistent_users', 'id') }}"
  
  # Test 3: Missing both tables
  - name: relationship_missing_both_tables
    description: "Should error: both tables don't exist in dbt catalog"
    left_table: "{{ table('fake_table_a') }}"
    right_table: "{{ table('fake_table_b') }}"
    relationship_conditions:
      - "{{ column('fake_table_a', 'id') }} = {{ column('fake_table_b', 'id') }}"
  
  # Test 4: Typo in table name
  - name: relationship_typo_in_table_name
    description: "Should error: common typo in table name"
    left_table: "{{ table('oder') }}"  # Typo: should be 'orders'
    right_table: "{{ table('users') }}"
    relationship_conditions:
      - "{{ column('oder', 'user_id') }} = {{ column('users', 'id') }}"
  
  # Test 5: Case sensitivity - table exists but wrong case
  - name: relationship_wrong_case_table
    description: "Should error or warn: table name with wrong case"
    left_table: "{{ table('ORDERS') }}"  # Wrong case - should handle gracefully
    right_table: "{{ table('users') }}"
    relationship_conditions:
      - "{{ column('ORDERS', 'user_id') }} = {{ column('users', 'id') }}"
  
  # Test 6: Table with missing metadata
  - name: relationship_table_missing_metadata
    description: "Should error: table exists but missing critical metadata (database, schema, primary_key)"
    left_table: "{{ table('orders') }}"
    right_table: "{{ table('incomplete_table') }}"
    relationship_conditions:
      - "{{ column('orders', 'user_id') }} = {{ column('incomplete_table', 'id') }}"
  
  # Test 7: Table from wrong database/schema
  - name: relationship_wrong_database_schema
    description: "Should error: table reference includes wrong database/schema prefix"
    left_table: "{{ table('orders') }}"
    right_table: "wrong_db.wrong_schema.users"  # Hardcoded reference instead of template
    relationship_conditions:
      - "{{ column('orders', 'user_id') }} = id"

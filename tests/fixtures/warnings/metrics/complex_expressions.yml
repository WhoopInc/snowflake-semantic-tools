snowflake_metrics:
  - name: overly_complex_metric
    description: "Metric with overly complex expression that might be hard to understand"
    expr: |
      CASE 
        WHEN {{ column('orders', 'status') }} = 'completed' 
          AND {{ column('orders', 'payment_status') }} = 'paid'
          AND {{ column('orders', 'created_at') }} >= CURRENT_DATE - INTERVAL 30 DAY
          AND {{ column('users', 'tier') }} IN ('premium', 'enterprise')
          AND {{ column('orders', 'amount') }} > 100
        THEN {{ column('orders', 'amount') }} * 0.95
        WHEN {{ column('orders', 'status') }} = 'completed' 
          AND {{ column('orders', 'payment_status') }} = 'paid'
        THEN {{ column('orders', 'amount') }} * 0.98
        ELSE 0
      END
    tables:
      - "{{ table('orders') }}"
      - "{{ table('users') }}"
